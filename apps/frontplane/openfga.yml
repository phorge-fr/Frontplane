apiVersion: v1
kind: Namespace
metadata:
    name: openfga
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBGMlNUcVJ3NlYzYWtVUko4
            Vi9KeDRUOE1GSk5LTU9GZ01DVVcvT0tGQngwCjRGalJScDNOaTRvWi9ZY0hGdjJn
            UWpzS1pvdTFWaWZxcGsybUNoODVDS3cKLS0tIERxZzlmOWNwemp3SU82RjhSWkxa
            ckNzcWxuaEZFUUlHMWZxMWVDQmZBVnMK2xbCmkW0hQFuQox7LN/8ocTb6W9ASYFU
            /5/tYX7V/eWXGFzoAzEWKPbBz7KslyGZlHtAY9TB98uDdyoFri5Z1Q==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:10:37Z"
    mac: ENC[AES256_GCM,data:T/vBQrRQkmQ1zbpLKCA1NW29VYG+Puaw++tYaBbM2uG5zqNAYN5hzQUX9OVyoQfZP+F2XxTEoQdzSZztV5P2RWrtIq9OaVsI2snX5+CM1dh/rxdmd6wNFvmNAMggiCkNNcy/jBL0Y4QoDjAxlJGKVaMxHmCk4wYUDKw0reMpMkU=,iv:C+8h3bHnLGkvXmxc76mVFYj0BfettysjgoZB4Ht7AaI=,tag:fWmhtHXEziFduTFTsb3iVA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
    name: openfga
    namespace: openfga
spec:
    interval: 1m0s
    timeout: 1m0s
    url: https://openfga.github.io/helm-charts
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBGMlNUcVJ3NlYzYWtVUko4
            Vi9KeDRUOE1GSk5LTU9GZ01DVVcvT0tGQngwCjRGalJScDNOaTRvWi9ZY0hGdjJn
            UWpzS1pvdTFWaWZxcGsybUNoODVDS3cKLS0tIERxZzlmOWNwemp3SU82RjhSWkxa
            ckNzcWxuaEZFUUlHMWZxMWVDQmZBVnMK2xbCmkW0hQFuQox7LN/8ocTb6W9ASYFU
            /5/tYX7V/eWXGFzoAzEWKPbBz7KslyGZlHtAY9TB98uDdyoFri5Z1Q==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:10:37Z"
    mac: ENC[AES256_GCM,data:T/vBQrRQkmQ1zbpLKCA1NW29VYG+Puaw++tYaBbM2uG5zqNAYN5hzQUX9OVyoQfZP+F2XxTEoQdzSZztV5P2RWrtIq9OaVsI2snX5+CM1dh/rxdmd6wNFvmNAMggiCkNNcy/jBL0Y4QoDjAxlJGKVaMxHmCk4wYUDKw0reMpMkU=,iv:C+8h3bHnLGkvXmxc76mVFYj0BfettysjgoZB4Ht7AaI=,tag:fWmhtHXEziFduTFTsb3iVA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: openfga
    namespace: openfga
spec:
    chart:
        spec:
            chart: openfga
            sourceRef:
                kind: HelmRepository
                name: openfga
            version: '*'
    interval: 1m0s
    values:
        nodeSelector:
            node-role.kubernetes.io/worker: "true"
        replicaCount: 1
        datastore:
            migrationType: initContainer
            engine: postgres
            uri: ENC[AES256_GCM,data:w0+/U+rB/FIYrgw+T8QdTm1fesWLUw0jq9qxulqCKN8sK+yn1alAktC+sNOAbdRwvnn6GGRAI/MM6vAJwSAc4pTrFj2TRrPyMomNKvVMszJLSD2ZQW6aD16YxYNEBpNOV2lyj2LUECQAcnnn3bkMapiQ,iv:ZPUGN3TrVdLBDrmKj0BxTjal5clKXVcsXoXeSK62B0c=,tag:pc4VydsuILc6ey2LWZCTOQ==,type:str]
        postgresql:
            image:
                tag: latest
            enabled: true
            auth:
                postgresPassword: ENC[AES256_GCM,data:+4jU1eCs0kW1CxdaNo4TfgiG8w==,iv:EBCmsNMJl7iDxGqGRw9A8Y09z1g1AyYG3ib71N1BCTY=,tag:1+GwJQWpJtI/AUACvcxz0A==,type:str]
                database: postgres
            primary:
                nodeSelector:
                    node-role.kubernetes.io/worker: "true"
                persistence:
                    enabled: true
                    size: 1Gi
        service:
            type: LoadBalancer
        authn:
            method: preshared
            preshared:
                keys:
                    - ENC[AES256_GCM,data:kl2LoisBNFjxD+sFQkFcPQ==,iv:aYi597NvxRhOK3o2wKqKccYRy1LHJA01TeULyQO95dg=,tag:Va1KNyK4KGKVlkCxrq25Aw==,type:str]
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBGMlNUcVJ3NlYzYWtVUko4
            Vi9KeDRUOE1GSk5LTU9GZ01DVVcvT0tGQngwCjRGalJScDNOaTRvWi9ZY0hGdjJn
            UWpzS1pvdTFWaWZxcGsybUNoODVDS3cKLS0tIERxZzlmOWNwemp3SU82RjhSWkxa
            ckNzcWxuaEZFUUlHMWZxMWVDQmZBVnMK2xbCmkW0hQFuQox7LN/8ocTb6W9ASYFU
            /5/tYX7V/eWXGFzoAzEWKPbBz7KslyGZlHtAY9TB98uDdyoFri5Z1Q==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:10:37Z"
    mac: ENC[AES256_GCM,data:T/vBQrRQkmQ1zbpLKCA1NW29VYG+Puaw++tYaBbM2uG5zqNAYN5hzQUX9OVyoQfZP+F2XxTEoQdzSZztV5P2RWrtIq9OaVsI2snX5+CM1dh/rxdmd6wNFvmNAMggiCkNNcy/jBL0Y4QoDjAxlJGKVaMxHmCk4wYUDKw0reMpMkU=,iv:C+8h3bHnLGkvXmxc76mVFYj0BfettysjgoZB4Ht7AaI=,tag:fWmhtHXEziFduTFTsb3iVA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
