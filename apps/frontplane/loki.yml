apiVersion: v1
kind: Namespace
metadata:
    name: loki
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA5aUlENExWL2FQVTRHdEgw
            OFBuWmNzWDJIY0YwWXl4OE54MS9SOTdNa1RzCnZ6eXZoeVVyQTEvTnA5THMxZGlv
            UjVRVTc3Tkk5ZVpleVNiVDd5OWNwUmsKLS0tIDFwbDBCejVOYlhYZDdtNU1tVzVF
            NVk2S3d0OEJvRGIwY0daZEhTSVkwaXMKevpPF7ra0tgmRHdHllIR2lDBSozjNu3V
            c7Bxx6bM9/m2iwTVmHavZzISXQYnGa87LMEovMqpAAE1ftnyLoCUgw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:14:33Z"
    mac: ENC[AES256_GCM,data:mXmFC14E5PIXzjnw51Qx/MZ8cUFT5IhGpaO5twTfUzLcXb8PfKDkg+8uOuYuZ83O30b89xkLeIl6a9PJjtfh2DbrFjfFQe5iiucuh1IJ+PCczb9RUjSAB1mmyX2/4yZYjzhUupmkazGJj+WA0t4jjMRfmV8vrQjvX/DNaXArd3E=,iv:JSGH59Bgbl9jDuhbICS+I3X4kPERdJknnefn9aOd5jk=,tag:DU2DXaBWgqZQYpgjVsG4tw==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: ConfigMap
metadata:
    name: loki-config
    namespace: loki
data:
    loki-config.yaml: ENC[AES256_GCM,data:6SK5AZaFyIMER7An21fTH6d8q1iHDKYhRccwW25WyfTNRWllKSjQ9rJohGOC/IVN0fqtJZFBLM/jFAc2acD8jOnIfEPJRVUzi4rngZH38yHC5gdXMjAqtsvUHnSNI/r7T/xV3F8gH1RgY1ZBQO/f87SA0lKRx5QcquQe9i4Hm1p6MkFNyrGYeFLDgltE2BaVb/9ZS6lW5GiG4SnFQ3o3CYyKuY/hsTE8z6IXy7cfeRKx87vBdVaXIt1xPo+D28XXWc+it7Bf8bE2vsDV3k2MicwJQMPxRBtyw1ss1isMdc5D3Pxo/e05a5i5JBM/A42zLInby5ZGSfSjpdN/ZbE2cJgHPJPDdkmNricOYBcjLBDy8JuzK/zMN0LhlRHuJk7ecbAcbF7lU7SlUevQ9U6kGsE8Pjq6H7MUavP/rpJSFPFOItfiKT0L+0DJWRve9xY1GeEncEfdNkeZFF+io/5+27tXPS55tzsht6qmdttbvJ7CRjcyRVJFh3Lk2Rbm7jfZlQgKLiKiUnooflM46I5gL+jELrZ8h1dZhl1suLKlHyKS1frPcs9C2vvtCRuFJDtW6va2C1stSnahzWttsC6dbPMEzStbtTJ52WnLVh2aK91ftnq8khwjZkzZdqtXLps0VOa81iOEGBTwc/5h1ONlwynJ9fY0Rd5c0ko/Hl3jbJ0EopndWB0gbNCEg/tkIycZ8RIOFIQUFncFyn/MWkPvz9Cv1IafzclFvIDI56yDf7w28BLKkLuU9Dnx9L2zch84cRBMJNy3BGb6lIWs5fhXMIOjH4s2zpA8k2gzDc/+uAexjZHEIKnPR1iDqh3VXxbuwZwnTtMRqaY+NwbTHXBalyU+sjw1q4+EmHckcoxYXGcLiLN8Z/+uanMOsUnef3FybHa2SSwYBdfjbGnkUQs3GmFxu4psoHFAIpxaxBv/mziCDCz8l4uW26oeeBGifnTZJLlQY1+EbJPFxsWcXJCGREDzTgduGW970yUcpi1q37rSH8/XpaFve/uyhI05ViysRvhokhrIdNQGfAx6Dl+iQLrw6rS1goQ/73z+rtTZ49HxC4+SYbY7uQykx/v9BtKjBERlhk7B3CJEclZYr29fXSi6okfB9L9+lTyy1yqEUtUavDOLkiqvOIcKcdmVj4h9EspLVB7bA+U=,iv:7n/EFibfsTvYVxJC002egfhbzFPb4YdgEJU3wNFjWdE=,tag:d9WIKBaCoWYKCdI5uZ5UUQ==,type:str]
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA5aUlENExWL2FQVTRHdEgw
            OFBuWmNzWDJIY0YwWXl4OE54MS9SOTdNa1RzCnZ6eXZoeVVyQTEvTnA5THMxZGlv
            UjVRVTc3Tkk5ZVpleVNiVDd5OWNwUmsKLS0tIDFwbDBCejVOYlhYZDdtNU1tVzVF
            NVk2S3d0OEJvRGIwY0daZEhTSVkwaXMKevpPF7ra0tgmRHdHllIR2lDBSozjNu3V
            c7Bxx6bM9/m2iwTVmHavZzISXQYnGa87LMEovMqpAAE1ftnyLoCUgw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:14:33Z"
    mac: ENC[AES256_GCM,data:mXmFC14E5PIXzjnw51Qx/MZ8cUFT5IhGpaO5twTfUzLcXb8PfKDkg+8uOuYuZ83O30b89xkLeIl6a9PJjtfh2DbrFjfFQe5iiucuh1IJ+PCczb9RUjSAB1mmyX2/4yZYjzhUupmkazGJj+WA0t4jjMRfmV8vrQjvX/DNaXArd3E=,iv:JSGH59Bgbl9jDuhbICS+I3X4kPERdJknnefn9aOd5jk=,tag:DU2DXaBWgqZQYpgjVsG4tw==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
    name: loki-pvc
    namespace: loki
spec:
    accessModes:
        - ReadWriteOnce
    resources:
        requests:
            storage: 5Gi
    volumeMode: Filesystem
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA5aUlENExWL2FQVTRHdEgw
            OFBuWmNzWDJIY0YwWXl4OE54MS9SOTdNa1RzCnZ6eXZoeVVyQTEvTnA5THMxZGlv
            UjVRVTc3Tkk5ZVpleVNiVDd5OWNwUmsKLS0tIDFwbDBCejVOYlhYZDdtNU1tVzVF
            NVk2S3d0OEJvRGIwY0daZEhTSVkwaXMKevpPF7ra0tgmRHdHllIR2lDBSozjNu3V
            c7Bxx6bM9/m2iwTVmHavZzISXQYnGa87LMEovMqpAAE1ftnyLoCUgw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:14:33Z"
    mac: ENC[AES256_GCM,data:mXmFC14E5PIXzjnw51Qx/MZ8cUFT5IhGpaO5twTfUzLcXb8PfKDkg+8uOuYuZ83O30b89xkLeIl6a9PJjtfh2DbrFjfFQe5iiucuh1IJ+PCczb9RUjSAB1mmyX2/4yZYjzhUupmkazGJj+WA0t4jjMRfmV8vrQjvX/DNaXArd3E=,iv:JSGH59Bgbl9jDuhbICS+I3X4kPERdJknnefn9aOd5jk=,tag:DU2DXaBWgqZQYpgjVsG4tw==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: loki
    namespace: loki
    labels:
        app: loki
spec:
    replicas: 1
    selector:
        matchLabels:
            app: loki
    template:
        metadata:
            labels:
                app: loki
        spec:
            nodeSelector:
                node-role.kubernetes.io/worker: "true"
            containers:
                - name: loki
                  image: grafana/loki:2.9.1
                  args:
                    - -config.file=/etc/loki/local-config.yaml
                  ports:
                    - containerPort: 3100
                  volumeMounts:
                    - name: loki-data
                      mountPath: /loki
                    - name: loki-config
                      mountPath: /etc/loki/local-config.yaml
                      subPath: loki-config.yaml
                  securityContext:
                    runAsUser: 0
            volumes:
                - name: loki-data
                  persistentVolumeClaim:
                    claimName: loki-pvc
                - name: loki-config
                  configMap:
                    name: loki-config
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA5aUlENExWL2FQVTRHdEgw
            OFBuWmNzWDJIY0YwWXl4OE54MS9SOTdNa1RzCnZ6eXZoeVVyQTEvTnA5THMxZGlv
            UjVRVTc3Tkk5ZVpleVNiVDd5OWNwUmsKLS0tIDFwbDBCejVOYlhYZDdtNU1tVzVF
            NVk2S3d0OEJvRGIwY0daZEhTSVkwaXMKevpPF7ra0tgmRHdHllIR2lDBSozjNu3V
            c7Bxx6bM9/m2iwTVmHavZzISXQYnGa87LMEovMqpAAE1ftnyLoCUgw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:14:33Z"
    mac: ENC[AES256_GCM,data:mXmFC14E5PIXzjnw51Qx/MZ8cUFT5IhGpaO5twTfUzLcXb8PfKDkg+8uOuYuZ83O30b89xkLeIl6a9PJjtfh2DbrFjfFQe5iiucuh1IJ+PCczb9RUjSAB1mmyX2/4yZYjzhUupmkazGJj+WA0t4jjMRfmV8vrQjvX/DNaXArd3E=,iv:JSGH59Bgbl9jDuhbICS+I3X4kPERdJknnefn9aOd5jk=,tag:DU2DXaBWgqZQYpgjVsG4tw==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: Service
metadata:
    name: loki
    namespace: loki
    labels:
        app: loki
spec:
    type: LoadBalancer
    ports:
        - port: 3100
          targetPort: 3100
          protocol: TCP
          name: loki
    selector:
        app: loki
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA5aUlENExWL2FQVTRHdEgw
            OFBuWmNzWDJIY0YwWXl4OE54MS9SOTdNa1RzCnZ6eXZoeVVyQTEvTnA5THMxZGlv
            UjVRVTc3Tkk5ZVpleVNiVDd5OWNwUmsKLS0tIDFwbDBCejVOYlhYZDdtNU1tVzVF
            NVk2S3d0OEJvRGIwY0daZEhTSVkwaXMKevpPF7ra0tgmRHdHllIR2lDBSozjNu3V
            c7Bxx6bM9/m2iwTVmHavZzISXQYnGa87LMEovMqpAAE1ftnyLoCUgw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:14:33Z"
    mac: ENC[AES256_GCM,data:mXmFC14E5PIXzjnw51Qx/MZ8cUFT5IhGpaO5twTfUzLcXb8PfKDkg+8uOuYuZ83O30b89xkLeIl6a9PJjtfh2DbrFjfFQe5iiucuh1IJ+PCczb9RUjSAB1mmyX2/4yZYjzhUupmkazGJj+WA0t4jjMRfmV8vrQjvX/DNaXArd3E=,iv:JSGH59Bgbl9jDuhbICS+I3X4kPERdJknnefn9aOd5jk=,tag:DU2DXaBWgqZQYpgjVsG4tw==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
