apiVersion: v1
kind: Namespace
metadata:
    name: loki
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA1bkV2ajdCcVFFN3duY2V1
            TGhKQUVsUzRqRlU3a3BDNDdtUis4dmpud0ZnCnVLcDZhQ2xRdk1hU3pUSitVVUJi
            MEMvV25TWXQzYXBpQU9NK1BWRHJkYlUKLS0tIGN5Wk10VnhZY25ZaGJoTlA2T0Vz
            dUM5YjVIcWNlS2NqeXQrN3o3WmJHRG8KM4Wt4t6sCILLzck35HIGT8iT9KDOX7OQ
            syAO44thU5eSFhJ5pPx4M3zKe/mj22IA9xgI8axokEHk2FkuDQMxCA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-18T14:23:30Z"
    mac: ENC[AES256_GCM,data:F+hT3BQssoL+jwKxN3zeDOTF5/3Sveh/lxsE4J4dYyCzGtzG2j35D7O9z8Ek0c+uB9b/lNenAVg0T4HurlqCc0QNGacppgCsMjNYuB040S/VsC46zJSBxrylCMOe3ryiYeQmWeqATii6pYb92NHVBKtfgeyDZd8rDzqD3e25eMo=,iv:1HASdwJgVdhcD10VawP1M8Ijs/yVVqKapI3hUvuiogc=,tag:y8XH+IXBlXBwmxoq6UNBMA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: ConfigMap
metadata:
    name: loki-config
    namespace: loki
data:
    loki-config.yaml: ENC[AES256_GCM,data:qbHIUaegJMbY+2AXNoEMhcziOpmErsobi7rmh5cASry03/Ol8fTi/pdPsddrK/WbiGlovgIM7J9MzxUuiLve4AYl2iagLTQ9OZzQ5BXnnKCP0CzbI6ykFc+PId7LO/ryFZnJ2tfAGXr1PIgmgUGh3Z5n1R3Vz9iPWIuZB+vbR36B69wLWUOa2YhCdT7vaL4BRCKYrRGrJ/jkGAV9GUy/CBrYjbSvfVT1wgzWFM3/NhxF4k4fAYG2NWZ64IV7+lEexy5gROr0R0hKSs70OwLwOJmMNS4QTDY2g0Xtd5kaa194pZFa1oYum/W619dQ2LypvO8r0EpQQ7N1BXdwH3RkCLh1kaKIAo2Pu3iZMQukSEl4SbNNKm5qjHNSloLiShiY1ucEGC3KNSmNRDnGoC1GlxdCQ3Py4/dKGCpB4MHHuModSmswbJtdMzrM21flj/y2hI/sSMBIFQBkuwJj3yFFzRunTOi73xiS5HiTG2PYD0Byutk6tmMDxB/8U8lBwEKfuo6TXmPh/87XSJisYy4vilFtOvqO2YuuHMuvUqK6vJjRlHF2swVICUn2cusKn5bXC/BUaSJygCLJs9HtNr0Z34BcVCbzeLCImQ+LsfQFBHMhPA5AKeL1/QYmTovgTiZeiCFDhwu3BlhbvOW4gI7chStDr883u+KTayBfdiF7/vb10N8WXJSmc25RPTMZ7goi6xm4MHjcDQHWkQkHK1h+qYGVHgUrGYzdrMoYcul0bHc6D06YooU0ZCVw2mpySNi7kqLKIbAoKk4ceejXc6Je8PO9Ej21xI+heiaGfpmgvbe+HJByzU+STJ2ute5BmMNBz4liwPalUKJjZ2rT9y0bHZ9nKPchlXMMEU2Ppa/nZu3AXgrKIkDZT+/omGcUYfXJOMXbHMldKd0n0kBcQ9bXSePFOcN57yinQVS3t5A4tOWyrvdcM4J3+f4hRuZsDDbAKhu5S+YA+BETApbMXqTWV9DYOKFoBdVWOH4+yXHSYKAYjYhX5ZdjdJatD3ENKRXTgmr30fcx9bIcc4PUg1l/66HRpLT69H8UIJwujhKZDxGFg2FTkpdiLiSAkEQMHlVGXLzFwZFumwvJeyDlGgLZlFa7H/xtYhdtiD817YwuJ2immXFn4u0nU2+uHI9l06xZ3pkQ6YboPTI=,iv:EVHM5LcSEl0gGiAn2IjH/k06eW11WCloiIWOMypZGKU=,tag:aE1pGWt+h7g01IQevu/FaQ==,type:str]
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA1bkV2ajdCcVFFN3duY2V1
            TGhKQUVsUzRqRlU3a3BDNDdtUis4dmpud0ZnCnVLcDZhQ2xRdk1hU3pUSitVVUJi
            MEMvV25TWXQzYXBpQU9NK1BWRHJkYlUKLS0tIGN5Wk10VnhZY25ZaGJoTlA2T0Vz
            dUM5YjVIcWNlS2NqeXQrN3o3WmJHRG8KM4Wt4t6sCILLzck35HIGT8iT9KDOX7OQ
            syAO44thU5eSFhJ5pPx4M3zKe/mj22IA9xgI8axokEHk2FkuDQMxCA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-18T14:23:30Z"
    mac: ENC[AES256_GCM,data:F+hT3BQssoL+jwKxN3zeDOTF5/3Sveh/lxsE4J4dYyCzGtzG2j35D7O9z8Ek0c+uB9b/lNenAVg0T4HurlqCc0QNGacppgCsMjNYuB040S/VsC46zJSBxrylCMOe3ryiYeQmWeqATii6pYb92NHVBKtfgeyDZd8rDzqD3e25eMo=,iv:1HASdwJgVdhcD10VawP1M8Ijs/yVVqKapI3hUvuiogc=,tag:y8XH+IXBlXBwmxoq6UNBMA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
    name: loki-pvc
    namespace: loki
spec:
    accessModes:
        - ReadWriteOnce
    resources:
        requests:
            storage: 5Gi
    volumeMode: Filesystem
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA1bkV2ajdCcVFFN3duY2V1
            TGhKQUVsUzRqRlU3a3BDNDdtUis4dmpud0ZnCnVLcDZhQ2xRdk1hU3pUSitVVUJi
            MEMvV25TWXQzYXBpQU9NK1BWRHJkYlUKLS0tIGN5Wk10VnhZY25ZaGJoTlA2T0Vz
            dUM5YjVIcWNlS2NqeXQrN3o3WmJHRG8KM4Wt4t6sCILLzck35HIGT8iT9KDOX7OQ
            syAO44thU5eSFhJ5pPx4M3zKe/mj22IA9xgI8axokEHk2FkuDQMxCA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-18T14:23:30Z"
    mac: ENC[AES256_GCM,data:F+hT3BQssoL+jwKxN3zeDOTF5/3Sveh/lxsE4J4dYyCzGtzG2j35D7O9z8Ek0c+uB9b/lNenAVg0T4HurlqCc0QNGacppgCsMjNYuB040S/VsC46zJSBxrylCMOe3ryiYeQmWeqATii6pYb92NHVBKtfgeyDZd8rDzqD3e25eMo=,iv:1HASdwJgVdhcD10VawP1M8Ijs/yVVqKapI3hUvuiogc=,tag:y8XH+IXBlXBwmxoq6UNBMA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: loki
    namespace: loki
    labels:
        app: loki
spec:
    replicas: 1
    selector:
        matchLabels:
            app: loki
    template:
        metadata:
            labels:
                app: loki
        spec:
            nodeSelector:
                node-role.kubernetes.io/worker: "true"
            containers:
                - name: loki
                  image: grafana/loki:2.9.1
                  args:
                    - -config.file=/etc/loki/local-config.yaml
                  ports:
                    - containerPort: 3100
                  volumeMounts:
                    - name: loki-data
                      mountPath: /loki
                    - name: loki-config
                      mountPath: /etc/loki/local-config.yaml
                      subPath: loki-config.yaml
                  securityContext:
                    runAsUser: 0
            volumes:
                - name: loki-data
                  persistentVolumeClaim:
                    claimName: loki-pvc
                - name: loki-config
                  configMap:
                    name: loki-config
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA1bkV2ajdCcVFFN3duY2V1
            TGhKQUVsUzRqRlU3a3BDNDdtUis4dmpud0ZnCnVLcDZhQ2xRdk1hU3pUSitVVUJi
            MEMvV25TWXQzYXBpQU9NK1BWRHJkYlUKLS0tIGN5Wk10VnhZY25ZaGJoTlA2T0Vz
            dUM5YjVIcWNlS2NqeXQrN3o3WmJHRG8KM4Wt4t6sCILLzck35HIGT8iT9KDOX7OQ
            syAO44thU5eSFhJ5pPx4M3zKe/mj22IA9xgI8axokEHk2FkuDQMxCA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-18T14:23:30Z"
    mac: ENC[AES256_GCM,data:F+hT3BQssoL+jwKxN3zeDOTF5/3Sveh/lxsE4J4dYyCzGtzG2j35D7O9z8Ek0c+uB9b/lNenAVg0T4HurlqCc0QNGacppgCsMjNYuB040S/VsC46zJSBxrylCMOe3ryiYeQmWeqATii6pYb92NHVBKtfgeyDZd8rDzqD3e25eMo=,iv:1HASdwJgVdhcD10VawP1M8Ijs/yVVqKapI3hUvuiogc=,tag:y8XH+IXBlXBwmxoq6UNBMA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: Service
metadata:
    name: loki
    namespace: loki
    labels:
        app: loki
spec:
    type: LoadBalancer
    loadBalancerIP: 10.0.0.11
    ports:
        - port: 3100
          targetPort: 3100
          protocol: TCP
          name: loki
    selector:
        app: loki
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA1bkV2ajdCcVFFN3duY2V1
            TGhKQUVsUzRqRlU3a3BDNDdtUis4dmpud0ZnCnVLcDZhQ2xRdk1hU3pUSitVVUJi
            MEMvV25TWXQzYXBpQU9NK1BWRHJkYlUKLS0tIGN5Wk10VnhZY25ZaGJoTlA2T0Vz
            dUM5YjVIcWNlS2NqeXQrN3o3WmJHRG8KM4Wt4t6sCILLzck35HIGT8iT9KDOX7OQ
            syAO44thU5eSFhJ5pPx4M3zKe/mj22IA9xgI8axokEHk2FkuDQMxCA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-18T14:23:30Z"
    mac: ENC[AES256_GCM,data:F+hT3BQssoL+jwKxN3zeDOTF5/3Sveh/lxsE4J4dYyCzGtzG2j35D7O9z8Ek0c+uB9b/lNenAVg0T4HurlqCc0QNGacppgCsMjNYuB040S/VsC46zJSBxrylCMOe3ryiYeQmWeqATii6pYb92NHVBKtfgeyDZd8rDzqD3e25eMo=,iv:1HASdwJgVdhcD10VawP1M8Ijs/yVVqKapI3hUvuiogc=,tag:y8XH+IXBlXBwmxoq6UNBMA==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
