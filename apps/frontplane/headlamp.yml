apiVersion: v1
kind: Namespace
metadata:
    name: headlamp
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB1ZjNGY0hvaExGOWMwemVh
            L2E1M1VYVlpPSG1RbCtqZ1hlY2NDUFdhMlRvCllOSmExUnIzNEdRdzdXMDFMNENV
            R1lKZHFzdnh5YUFMRSs5TlhoMG4zUWcKLS0tIG8yNTFJcy9YYVFlWTd1N2VHZHh4
            TXRORkZvZHJKWlR0bUJHa2xMQWxLZlkKT8cxKxj5OyHB60xSsxE0q8fw2z3KkAYZ
            /9iyv9IOfofNxw9QKwD588ZuX2jBWqdD4q4fN+H8Vt7ZndZHy0FsOA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:11:43Z"
    mac: ENC[AES256_GCM,data:sld1uh21+s87Mwo0sfeEWuNe/CiOE8w/Wjk2Lf/MY9Cdwxcd6JfThtT3pbyskCpm4XhoM5QOSWAkmRdKHzjfbOjvwdrgwcLJBsvM9sWW5RqVEoUKG6M+BfwVJJfi6Tf6Dvcpww/vOTED4UkUyAYcMJlWuq3NWfW8RAGiOCe7vpQ=,iv:LhxbMuPP9cc252GdKVLByz6aZ+zQByJUk2gxI/D3Meg=,tag:rtzV9GrBDzb5f6WHtzM14w==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
    name: headlamp
    namespace: headlamp
spec:
    interval: 1m0s
    timeout: 1m0s
    url: https://kubernetes-sigs.github.io/headlamp/
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB1ZjNGY0hvaExGOWMwemVh
            L2E1M1VYVlpPSG1RbCtqZ1hlY2NDUFdhMlRvCllOSmExUnIzNEdRdzdXMDFMNENV
            R1lKZHFzdnh5YUFMRSs5TlhoMG4zUWcKLS0tIG8yNTFJcy9YYVFlWTd1N2VHZHh4
            TXRORkZvZHJKWlR0bUJHa2xMQWxLZlkKT8cxKxj5OyHB60xSsxE0q8fw2z3KkAYZ
            /9iyv9IOfofNxw9QKwD588ZuX2jBWqdD4q4fN+H8Vt7ZndZHy0FsOA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:11:43Z"
    mac: ENC[AES256_GCM,data:sld1uh21+s87Mwo0sfeEWuNe/CiOE8w/Wjk2Lf/MY9Cdwxcd6JfThtT3pbyskCpm4XhoM5QOSWAkmRdKHzjfbOjvwdrgwcLJBsvM9sWW5RqVEoUKG6M+BfwVJJfi6Tf6Dvcpww/vOTED4UkUyAYcMJlWuq3NWfW8RAGiOCe7vpQ=,iv:LhxbMuPP9cc252GdKVLByz6aZ+zQByJUk2gxI/D3Meg=,tag:rtzV9GrBDzb5f6WHtzM14w==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: headlamp
    namespace: headlamp
spec:
    chart:
        spec:
            chart: headlamp
            sourceRef:
                kind: HelmRepository
                name: headlamp
            version: '*'
    interval: 1m0s
    values:
        ingress:
            enabled: true
            ingressClassName: nginx
            annotations:
                cert-manager.io/cluster-issuer: letsencrypt
            hosts:
                - host: frontplane.phorge.fr
                  paths:
                    - path: /
                      type: ImplementationSpecific
            tls:
                - secretName: headlamp-tls
                  hosts:
                    - frontplane.phorge.fr
        config:
            inCluster: true
            oidc:
                secret:
                    create: ENC[AES256_GCM,data:UBy1vg==,iv:CkS9ix+tff0curOvKNVlax96Wd38auMpgbHmQRTgl2g=,tag:/KbIo8M8Vk648cnsw4wG1w==,type:bool]
                    name: ENC[AES256_GCM,data:djLkQA==,iv:vw5VKMns09ndSMMSQTnqYx3pNdJEuEd4NCZ6p06ypZY=,tag:9gnPOS5zwszt9mduoWXcAw==,type:str]
                clientID: ENC[AES256_GCM,data:ZSlXMYrJYWbmHmufW6+7cL1c05HvYnPNTtuqLrwDlRytMnRs,iv:N3ZO3iAGz5tNnOhX8nrK2k8O1yhlDW4jLMsx7eSOkb8=,tag:f1/pP6D9dG1lwThS8jG4EQ==,type:str]
                clientSecret: ENC[AES256_GCM,data:Dtx/p/siZSBqQAWNow2OS8ogbv6lxTJ/u3Q7G02sAVQFX4euh58jlQ5/Kb2JzeQDTZUg2vuW8Ms=,iv:UuYzirW27GczQXLS2xPQYCsq6ekqHw/D75aOV8himX4=,tag:9lc4pfLDzHEcCXWQ1bupaQ==,type:str]
                issuerURL: https://git.phorge.fr/
                scopes: profile, email, groups
                callbackURL: https://frontplane.phorge.fr/oidc-callback
                # pluginsDir: /build/plugins
        # initContainers:
        #   - command:
        #       - /bin/sh
        #       - -c
        #       - mkdir -p /build/plugins && cp -r /plugins/* /build/plugins/
        #     image: ghcr.io/headlamp-k8s/headlamp-plugin-flux:latest
        #     imagePullPolicy: Always
        #     name: headlamp-plugins
        #     volumeMounts:
        #       - mountPath: /build/plugins
        #         name: headlamp-plugins
        # persistentVolumeClaim:
        #   accessModes:
        #     - ReadWriteOnce
        #   enabled: true
        #   size: 1Gi
        #   volumeMode: Filesystem
        #   storageClassName: longhorn
        # volumeMounts:
        #   - mountPath: /build/plugins
        #     name: headlamp-plugins
        # volumes:
        #   - name: headlamp-plugins
        #     persistentVolumeClaim:
        #       claimName: headlamp
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB1ZjNGY0hvaExGOWMwemVh
            L2E1M1VYVlpPSG1RbCtqZ1hlY2NDUFdhMlRvCllOSmExUnIzNEdRdzdXMDFMNENV
            R1lKZHFzdnh5YUFMRSs5TlhoMG4zUWcKLS0tIG8yNTFJcy9YYVFlWTd1N2VHZHh4
            TXRORkZvZHJKWlR0bUJHa2xMQWxLZlkKT8cxKxj5OyHB60xSsxE0q8fw2z3KkAYZ
            /9iyv9IOfofNxw9QKwD588ZuX2jBWqdD4q4fN+H8Vt7ZndZHy0FsOA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:11:43Z"
    mac: ENC[AES256_GCM,data:sld1uh21+s87Mwo0sfeEWuNe/CiOE8w/Wjk2Lf/MY9Cdwxcd6JfThtT3pbyskCpm4XhoM5QOSWAkmRdKHzjfbOjvwdrgwcLJBsvM9sWW5RqVEoUKG6M+BfwVJJfi6Tf6Dvcpww/vOTED4UkUyAYcMJlWuq3NWfW8RAGiOCe7vpQ=,iv:LhxbMuPP9cc252GdKVLByz6aZ+zQByJUk2gxI/D3Meg=,tag:rtzV9GrBDzb5f6WHtzM14w==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: v1
kind: ServiceAccount
metadata:
    name: headlamp-admin
    namespace: kube-system
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB1ZjNGY0hvaExGOWMwemVh
            L2E1M1VYVlpPSG1RbCtqZ1hlY2NDUFdhMlRvCllOSmExUnIzNEdRdzdXMDFMNENV
            R1lKZHFzdnh5YUFMRSs5TlhoMG4zUWcKLS0tIG8yNTFJcy9YYVFlWTd1N2VHZHh4
            TXRORkZvZHJKWlR0bUJHa2xMQWxLZlkKT8cxKxj5OyHB60xSsxE0q8fw2z3KkAYZ
            /9iyv9IOfofNxw9QKwD588ZuX2jBWqdD4q4fN+H8Vt7ZndZHy0FsOA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:11:43Z"
    mac: ENC[AES256_GCM,data:sld1uh21+s87Mwo0sfeEWuNe/CiOE8w/Wjk2Lf/MY9Cdwxcd6JfThtT3pbyskCpm4XhoM5QOSWAkmRdKHzjfbOjvwdrgwcLJBsvM9sWW5RqVEoUKG6M+BfwVJJfi6Tf6Dvcpww/vOTED4UkUyAYcMJlWuq3NWfW8RAGiOCe7vpQ=,iv:LhxbMuPP9cc252GdKVLByz6aZ+zQByJUk2gxI/D3Meg=,tag:rtzV9GrBDzb5f6WHtzM14w==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
    name: headlamp-admin
roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: cluster-admin
subjects:
    - kind: ServiceAccount
      name: headlamp-admin
      namespace: kube-system
sops:
    age:
        - recipient: age1ae6yk6xtlt8h40272xqxegz3t3zpvvuxj0jwy489xs6e34k0y9xsvpmt03
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB1ZjNGY0hvaExGOWMwemVh
            L2E1M1VYVlpPSG1RbCtqZ1hlY2NDUFdhMlRvCllOSmExUnIzNEdRdzdXMDFMNENV
            R1lKZHFzdnh5YUFMRSs5TlhoMG4zUWcKLS0tIG8yNTFJcy9YYVFlWTd1N2VHZHh4
            TXRORkZvZHJKWlR0bUJHa2xMQWxLZlkKT8cxKxj5OyHB60xSsxE0q8fw2z3KkAYZ
            /9iyv9IOfofNxw9QKwD588ZuX2jBWqdD4q4fN+H8Vt7ZndZHy0FsOA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2026-01-12T23:11:43Z"
    mac: ENC[AES256_GCM,data:sld1uh21+s87Mwo0sfeEWuNe/CiOE8w/Wjk2Lf/MY9Cdwxcd6JfThtT3pbyskCpm4XhoM5QOSWAkmRdKHzjfbOjvwdrgwcLJBsvM9sWW5RqVEoUKG6M+BfwVJJfi6Tf6Dvcpww/vOTED4UkUyAYcMJlWuq3NWfW8RAGiOCe7vpQ=,iv:LhxbMuPP9cc252GdKVLByz6aZ+zQByJUk2gxI/D3Meg=,tag:rtzV9GrBDzb5f6WHtzM14w==,type:str]
    encrypted_regex: ^(email|password|secret_key|data|stringData|ca|crt|key|id|secret|token|aggregatorCA|serviceAccount|bootstraptoken|secretboxencryptionsecret|secretboxEncryptionSecret|clientSecret|clientId|clientID|external-dns.alpha.kubernetes.io/target|adminPassword|metrics.crt|metrics.key|ca.crt|uri|postgresPassword|preshared|username)$
    version: 3.11.0
